{% extends "base.html" %}
{% block content %}
<h1 class="h3 mb-4">Air Quality Trends Graphical Overview</h1>
{% if not ready %}
  <div class="alert alert-warning">Models are not trained yet. Train them first to enable trends.</div>
{% else %}
  <div class="card shadow-sm p-4">
    <canvas id="trendChart" style="height: 500px;"></canvas>
  </div>

  <script>
    const series = {{ series|tojson }};
    const ctx = document.getElementById('trendChart');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: series.datetime,
        datasets: [
          {
            label: 'AQI (observed)', 
            data: series.AQI, 
            borderColor: 'rgb(54, 162, 235)',
            backgroundColor: 'rgba(54, 162, 235, 0.1)',
            tension: 0.4,
            borderWidth: 2,
            fill: true
          },
          {
            label: 'PM2.5 (observed)', 
            data: series.PM25, 
            borderColor: 'rgb(255, 99, 132)',
            backgroundColor: 'rgba(255, 99, 132, 0.1)',
            tension: 0.4,
            borderWidth: 2,
            fill: true
          },
          {
            label: 'PM10 (observed)', 
            data: series.PM10, 
            borderColor: 'rgb(255, 159, 64)',
            backgroundColor: 'rgba(255, 159, 64, 0.1)',
            tension: 0.4,
            borderWidth: 2,
            fill: true
          },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: { 
          legend: { 
            position: 'top',
            labels: {
              font: { size: 14 },
              padding: 15
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleFont: { size: 14 },
            bodyFont: { size: 13 }
          }
        },
        scales: { 
          x: { 
            ticks: { 
              maxRotation: 45,
              minRotation: 45,
              font: { size: 11 }
            },
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              font: { size: 12 }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          }
        }
      }
    });
  </script>
{% endif %}
{% endblock %}
